<span class="keyword">int</span> tail <span class="operator">=</span> <span class="integer">400</span>;
<span class="entity class">Point</span>[] points <span class="operator">=</span> <span class="keyword">new</span> <span class="entity class">Point</span>[<span class="integer">5</span>];
<span class="entity class">Line</span> aToBprime, bToAprime, aPrimeToC, bPrimeToC, middle, <span class="entity class">Am</span>, <span class="entity class">Bn</span>;
<span class="entity class">PVector</span> dir <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">PVector</span>(<span class="integer">1</span>,<span class="integer">0</span>);
<span class="entity class">Point</span> l,m,n;

<span class="entity class">Point</span> artist <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">Point</span>(<span class="keyword">new</span> <span class="entity function">PVector</span>(<span class="operator">-</span><span class="integer">10</span>,<span class="operator">-</span><span class="integer">10</span>));;
<span class="entity class">Draws</span> pen <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">Draws</span>(artist);

<span class="entity class">PVector</span> sect;

<span class="keyword">void</span> <span class="entity function">setup</span>(){
  <span class="entity function">size</span>(<span class="integer">500</span>, <span class="integer">500</span>);
  points[<span class="integer">0</span>] <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">Point</span>(<span class="keyword">new</span> <span class="entity function">PVector</span>(<span class="integer">200</span>,<span class="integer">200</span>));<span class="comment">//A</span>
  points[<span class="integer">1</span>] <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">Point</span>(<span class="keyword">new</span> <span class="entity function">PVector</span>(<span class="integer">400</span>,<span class="integer">100</span>));<span class="comment">//B</span>
  points[<span class="integer">2</span>] <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">Point</span>(<span class="keyword">new</span> <span class="entity function">PVector</span>(<span class="integer">300</span>,<span class="integer">200</span>));<span class="comment">//C</span>
  points[<span class="integer">3</span>] <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">Point</span>(<span class="keyword">new</span> <span class="entity function">PVector</span>(<span class="integer">200</span>,<span class="integer">400</span>));<span class="comment">//A'</span>
  points[<span class="integer">4</span>] <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">Point</span>(<span class="keyword">new</span> <span class="entity function">PVector</span>(<span class="integer">400</span>,<span class="integer">300</span>));<span class="comment">//B'</span>
  aToBprime <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">Line</span>(points[<span class="integer">0</span>], points[<span class="integer">4</span>]);
  bToAprime <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">Line</span>(points[<span class="integer">1</span>], points[<span class="integer">3</span>]);
  aPrimeToC <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">Line</span>(points[<span class="integer">3</span>], points[<span class="integer">2</span>]);
  bPrimeToC <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">Line</span>(points[<span class="integer">4</span>], points[<span class="integer">2</span>]);
}

<span class="keyword">void</span> <span class="entity function">draw</span>(){
  <span class="entity function">background</span>(<span class="integer">220</span>);
  <span class="entity function">for</span>(<span class="entity class">Point</span> p <span class="operator">:</span> points){
    p<span class="operator">.</span><span class="entity function">update</span>();
  } 
  
  aToBprime<span class="operator">.</span><span class="entity function">update</span>();
  aToBprime<span class="operator">.</span><span class="entity function">render</span>();
  bToAprime<span class="operator">.</span><span class="entity function">update</span>();
  bToAprime<span class="operator">.</span><span class="entity function">render</span>();
  aPrimeToC<span class="operator">.</span><span class="entity function">update</span>();
  aPrimeToC<span class="operator">.</span><span class="entity function">render</span>();
  bPrimeToC<span class="operator">.</span><span class="entity function">update</span>();
  bPrimeToC<span class="operator">.</span><span class="entity function">render</span>();
  l <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">Point</span>(aToBprime<span class="operator">.</span><span class="entity function">intersection</span>(bToAprime));
  middle <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">Line</span>(l, <span class="keyword">new</span> <span class="entity function">Point</span>(<span class="keyword">new</span> <span class="entity function">PVector</span>(l<span class="operator">.</span>position<span class="operator">.</span>x<span class="operator">+</span>dir<span class="operator">.</span>x, l<span class="operator">.</span>position<span class="operator">.</span>y<span class="operator">+</span>dir<span class="operator">.</span>y)));
  m <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">Point</span>(aPrimeToC<span class="operator">.</span><span class="entity function">intersection</span>(middle));
  n <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">Point</span>(bPrimeToC<span class="operator">.</span><span class="entity function">intersection</span>(middle));
  <span class="entity class">Am</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">Line</span>(points[<span class="integer">0</span>], m);
  <span class="entity class">Bn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">Line</span>(points[<span class="integer">1</span>], n);
  
  artist<span class="operator">.</span>position <span class="operator">=</span> <span class="entity class">Am</span><span class="operator">.</span><span class="entity function">intersection</span>(<span class="entity class">Bn</span>);
  
  <span class="entity class">Am</span><span class="operator">.</span><span class="entity function">update</span>();
  <span class="entity class">Am</span><span class="operator">.</span><span class="entity function">render</span>();
  <span class="entity class">Bn</span><span class="operator">.</span><span class="entity function">update</span>();
  <span class="entity class">Bn</span><span class="operator">.</span><span class="entity function">render</span>();
  
  middle<span class="operator">.</span><span class="entity function">update</span>();
  middle<span class="operator">.</span><span class="entity function">render</span>(); 
  
  <span class="entity function">ellipse</span>(l<span class="operator">.</span>position<span class="operator">.</span>x, l<span class="operator">.</span>position<span class="operator">.</span>y, <span class="integer">20</span>, <span class="integer">20</span>);
  <span class="entity function">ellipse</span>(m<span class="operator">.</span>position<span class="operator">.</span>x, m<span class="operator">.</span>position<span class="operator">.</span>y, <span class="integer">20</span>, <span class="integer">20</span>);
  <span class="entity function">ellipse</span>(n<span class="operator">.</span>position<span class="operator">.</span>x, n<span class="operator">.</span>position<span class="operator">.</span>y, <span class="integer">20</span>, <span class="integer">20</span>);
  
  dir <span class="operator">=</span> <span class="entity function">rotateVector</span>(dir, <span class="integer">0</span><span class="operator">.</span><span class="integer">01</span>);
    
  artist<span class="operator">.</span><span class="entity function">update</span>();
  artist<span class="operator">.</span><span class="entity function">render</span>();
  
  pen<span class="operator">.</span><span class="entity function">update</span>();
  pen<span class="operator">.</span><span class="entity function">render</span>();

  <span class="entity function">for</span>(<span class="entity class">Point</span> p<span class="operator">:</span> points){
    p<span class="operator">.</span><span class="entity function">render</span>();
  }
}

<span class="keyword">class</span> <span class="entity class">Draws</span>{
 <span class="entity class">ArrayList</span><span class="operator">&lt;</span>pvector<span class="operator">&gt;</span> points <span class="operator">=</span> <span class="keyword">new</span> <span class="entity function">ArrayList&lt;pvector&gt;</span>();
 <span class="entity class">Point</span> p;
 
 <span class="keyword">public</span> <span class="entity function">Draws</span>(<span class="entity class">Point</span> p_){
  p <span class="operator">=</span> p_;
 } 
 
 <span class="keyword">void</span> <span class="entity function">update</span>(){
  points<span class="operator">.</span><span class="entity function">add</span>(p<span class="operator">.</span>position);
  <span class="entity function">if</span>(points<span class="operator">.</span><span class="entity function">size</span>() <span class="operator">&gt;</span> tail){
   points<span class="operator">.</span><span class="entity function">remove</span>(<span class="integer">0</span>);
  } 
 }
 
 <span class="keyword">void</span> <span class="entity function">render</span>(){
  <span class="entity function">for</span>(<span class="keyword">int</span> i <span class="operator">=</span> <span class="integer">0</span>; i <span class="operator">&lt;</span> points<span class="operator">.</span><span class="entity function">size</span>()<span class="operator">-</span><span class="integer">1</span>; i<span class="operator">++</span>){
   <span class="entity function">stroke</span>(<span class="integer">50</span>, <span class="integer">100</span>);
   <span class="entity function">strokeWeight</span>(<span class="integer">3</span>);
   <span class="entity function">line</span>(points<span class="operator">.</span><span class="entity function">get</span>(i)<span class="operator">.</span>x, points<span class="operator">.</span><span class="entity function">get</span>(i)<span class="operator">.</span>y, points<span class="operator">.</span><span class="entity function">get</span>(i<span class="operator">+</span><span class="integer">1</span>)<span class="operator">.</span>x, points<span class="operator">.</span><span class="entity function">get</span>(i<span class="operator">+</span><span class="integer">1</span>)<span class="operator">.</span>y);
   <span class="entity function">stroke</span>(<span class="integer">255</span>);
   <span class="entity function">strokeWeight</span>(<span class="integer">1</span>);
  } 
 }
}

<span class="keyword">class</span> <span class="entity class">Line</span>{
  <span class="entity class">Point</span> start, end;
  <span class="keyword">float</span> <span class="static">A</span>, <span class="static">B</span>, <span class="static">C</span>;
 
 
  <span class="keyword">public</span> <span class="entity function">Line</span>(<span class="entity class">Point</span> start_, <span class="entity class">Point</span> end_){
    start <span class="operator">=</span> start_;
    end <span class="operator">=</span> end_;
    <span class="static">A</span> <span class="operator">=</span> <span class="entity function">-</span>(end<span class="operator">.</span>position<span class="operator">.</span>y<span class="operator">-</span>start<span class="operator">.</span>position<span class="operator">.</span><span class="entity function">y)/</span>(end<span class="operator">.</span>position<span class="operator">.</span>x<span class="operator">-</span>start<span class="operator">.</span>position<span class="operator">.</span>x);
    <span class="static">B</span> <span class="operator">=</span> <span class="integer">1</span>;
    <span class="static">C</span> <span class="operator">=</span> start<span class="operator">.</span>position<span class="operator">.</span><span class="entity function">y-</span>(end<span class="operator">.</span>position<span class="operator">.</span>y<span class="operator">-</span>start<span class="operator">.</span>position<span class="operator">.</span><span class="entity function">y)/</span>(end<span class="operator">.</span>position<span class="operator">.</span>x<span class="operator">-</span>start<span class="operator">.</span>position<span class="operator">.</span>x)<span class="operator">*</span>start<span class="operator">.</span>position<span class="operator">.</span>x;
  } 
  
  <span class="keyword">void</span> <span class="entity function">update</span>(){
    <span class="static">A</span> <span class="operator">=</span> <span class="entity function">-</span>(end<span class="operator">.</span>position<span class="operator">.</span>y<span class="operator">-</span>start<span class="operator">.</span>position<span class="operator">.</span><span class="entity function">y)/</span>(end<span class="operator">.</span>position<span class="operator">.</span>x<span class="operator">-</span>start<span class="operator">.</span>position<span class="operator">.</span>x);
    <span class="static">B</span> <span class="operator">=</span> <span class="integer">1</span>;
    <span class="static">C</span> <span class="operator">=</span> start<span class="operator">.</span>position<span class="operator">.</span><span class="entity function">y-</span>(end<span class="operator">.</span>position<span class="operator">.</span>y<span class="operator">-</span>start<span class="operator">.</span>position<span class="operator">.</span><span class="entity function">y)/</span>(end<span class="operator">.</span>position<span class="operator">.</span>x<span class="operator">-</span>start<span class="operator">.</span>position<span class="operator">.</span>x)<span class="operator">*</span>start<span class="operator">.</span>position<span class="operator">.</span>x; 
  }
  
  <span class="keyword">void</span> <span class="entity function">render</span>(){
   <span class="keyword">float</span> y1 <span class="operator">=</span> <span class="static">C</span><span class="operator">/</span><span class="static">B</span>;
   <span class="keyword">float</span> y2 <span class="operator">=</span> <span class="operator">-</span><span class="static">A</span><span class="operator">/</span><span class="static">B</span><span class="operator">*</span>width<span class="operator">+</span><span class="static">C</span><span class="operator">/</span><span class="static">B</span>;
   <span class="entity function">stroke</span>(<span class="integer">255</span>);
   <span class="entity function">line</span>(<span class="integer">0</span>, y1, width, y2); 
  }
    
  <span class="entity class">PVector</span> <span class="entity function">intersection</span>(<span class="entity class">Line</span> l){
    <span class="keyword">float</span>[][] coeffMat <span class="operator">=</span> <span class="keyword">new</span> <span class="keyword">float</span>[<span class="integer">2</span>][<span class="integer">2</span>];
    coeffMat[<span class="integer">0</span>][<span class="integer">0</span>] <span class="operator">=</span> <span class="static">A</span>;
    coeffMat[<span class="integer">1</span>][<span class="integer">0</span>] <span class="operator">=</span> l<span class="operator">.</span><span class="static">A</span>;
    coeffMat[<span class="integer">0</span>][<span class="integer">1</span>] <span class="operator">=</span> <span class="static">B</span>;
    coeffMat[<span class="integer">1</span>][<span class="integer">1</span>] <span class="operator">=</span> l<span class="operator">.</span><span class="static">B</span>;
    <span class="keyword">float</span>[][] sols <span class="operator">=</span> {{<span class="static">C</span>, <span class="integer">0</span>},{l<span class="operator">.</span><span class="static">C</span>,<span class="integer">0</span>}};
    <span class="keyword">float</span>[][] inv <span class="operator">=</span> <span class="entity function">inverse</span>(coeffMat);
    <span class="keyword">float</span>[][] intSols <span class="operator">=</span> <span class="entity function">mMult</span>(inv, sols);
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="entity function">PVector</span>(intSols[<span class="integer">0</span>][<span class="integer">0</span>], intSols[<span class="integer">1</span>][<span class="integer">0</span>]);
    
    
  }
  
}

<span class="keyword">float</span>[][] <span class="entity function">mMult</span>(<span class="keyword">float</span>[][]<span class="static">A</span>, <span class="keyword">float</span>[][]<span class="static">B</span>){
  <span class="keyword">float</span>[][] resultant <span class="operator">=</span> <span class="keyword">new</span> <span class="keyword">float</span>[<span class="static">A</span><span class="operator">.</span>length][<span class="static">B</span>[<span class="integer">0</span>]<span class="operator">.</span>length];
  <span class="entity function">for</span>(<span class="keyword">int</span> i <span class="operator">=</span> <span class="integer">0</span>; i <span class="operator">&lt;</span> <span class="static">A</span><span class="operator">.</span>length; i<span class="operator">++</span>){<span class="comment">//A height</span>
    <span class="entity function">for</span>(<span class="keyword">int</span> j <span class="operator">=</span> <span class="integer">0</span>; j <span class="operator">&lt;</span> <span class="static">B</span>[<span class="integer">0</span>]<span class="operator">.</span>length; j<span class="operator">++</span>){<span class="comment">//B width</span>
      <span class="entity function">for</span>(<span class="keyword">int</span> k <span class="operator">=</span> <span class="integer">0</span>; k <span class="operator">&lt;</span> <span class="static">B</span><span class="operator">.</span>length; k<span class="operator">++</span>){
        resultant[i][j] <span class="operator">+</span><span class="operator">=</span> <span class="static">A</span>[i][k]<span class="operator">*</span><span class="static">B</span>[k][j];
      }
    }
  }
  <span class="keyword">return</span> resultant;
}

<span class="keyword">float</span>[][] <span class="entity function">inverse</span>(<span class="keyword">float</span>[][] m){
  <span class="keyword">float</span> det <span class="operator">=</span> m[<span class="integer">1</span>][<span class="integer">1</span>]<span class="operator">*</span>m[<span class="integer">0</span>][<span class="integer">0</span>]<span class="operator">-</span>m[<span class="integer">1</span>][<span class="integer">0</span>]<span class="operator">*</span>m[<span class="integer">0</span>][<span class="integer">1</span>];
  <span class="keyword">float</span>[][] augmented <span class="operator">=</span> <span class="keyword">new</span> <span class="keyword">float</span>[<span class="integer">2</span>][<span class="integer">2</span>];
  augmented[<span class="integer">0</span>][<span class="integer">0</span>] <span class="operator">=</span> m[<span class="integer">1</span>][<span class="integer">1</span>]<span class="operator">/</span>det;
  augmented[<span class="integer">0</span>][<span class="integer">1</span>] <span class="operator">=</span> <span class="operator">-</span>m[<span class="integer">0</span>][<span class="integer">1</span>]<span class="operator">/</span>det;
  augmented[<span class="integer">1</span>][<span class="integer">0</span>] <span class="operator">=</span> <span class="operator">-</span>m[<span class="integer">1</span>][<span class="integer">0</span>]<span class="operator">/</span>det;
  augmented[<span class="integer">1</span>][<span class="integer">1</span>] <span class="operator">=</span> m[<span class="integer">0</span>][<span class="integer">0</span>]<span class="operator">/</span>det;  
  <span class="keyword">return</span> augmented;
}

<span class="keyword">class</span> <span class="entity class">Point</span>{
 <span class="entity class">PVector</span> position;
 <span class="keyword">boolean</span> isClicked <span class="operator">=</span> <span class="truth">false</span>;
 <span class="keyword">public</span> <span class="entity function">Point</span>(<span class="entity class">PVector</span> pos){
  position <span class="operator">=</span> pos;
 } 
 
 <span class="keyword">void</span> <span class="entity function">update</span>(){
   <span class="entity function">if</span>(isClicked){
    position<span class="operator">.</span><span class="entity function">add</span>(<span class="entity class">PVector</span><span class="operator">.</span><span class="entity function">sub</span>(<span class="keyword">new</span> <span class="entity function">PVector</span>(mouseX, mouseY), position)); 
   }
 }
 
 <span class="keyword">void</span> <span class="entity function">render</span>(){
   <span class="entity function">noStroke</span>();
   <span class="entity function">fill</span>(<span class="integer">102</span>,<span class="integer">225</span>,<span class="integer">240</span>);
   <span class="entity function">if</span>(isClicked){
    <span class="entity function">fill</span>(<span class="integer">255</span>); 
   }
   <span class="entity function">ellipse</span>(position<span class="operator">.</span>x, position<span class="operator">.</span>y, <span class="integer">10</span>, <span class="integer">10</span>);
   <span class="entity function">fill</span>(<span class="integer">102</span>,<span class="integer">225</span>,<span class="integer">240</span>);
 }
}


<span class="keyword">void</span> <span class="entity function">mousePressed</span>(){
 <span class="entity function">for</span>(<span class="entity class">Point</span> p <span class="operator">:</span> points){
   <span class="entity function">if</span>(p<span class="operator">.</span>isClicked){
     <span class="keyword">break</span>; 
   }
  } 
 <span class="entity function">for</span>(<span class="entity class">Point</span> p<span class="operator">:</span> points){
  <span class="entity function">if</span>(<span class="entity class">PVector</span><span class="operator">.</span><span class="entity function">sub</span>(p<span class="operator">.</span>position, <span class="keyword">new</span> <span class="entity function">PVector</span>(mouseX, mouseY))<span class="operator">.</span><span class="entity function">mag</span>() <span class="operator">&lt;</span> <span class="integer">10</span>){
   p<span class="operator">.</span>isClicked  <span class="operator">=</span> <span class="truth">true</span>;
   <span class="keyword">break</span>;
  } 
 }
}

<span class="keyword">void</span> <span class="entity function">mouseReleased</span>(){
  <span class="entity function">for</span>(<span class="entity class">Point</span> p <span class="operator">:</span> points){
   p<span class="operator">.</span>isClicked <span class="operator">=</span> <span class="truth">false</span>;
  } 
}

<span class="entity class">PVector</span> <span class="entity function">rotateVector</span>(<span class="entity class">PVector</span> vect, <span class="keyword">float</span> theta) {
    <span class="keyword">float</span> xTemp <span class="operator">=</span> vect<span class="operator">.</span>x;
    vect<span class="operator">.</span>x <span class="operator">=</span> vect<span class="operator">.</span><span class="entity function">x*cos</span>(theta) <span class="operator">-</span> vect<span class="operator">.</span><span class="entity function">y*sin</span>(theta);
    vect<span class="operator">.</span>y <span class="operator">=</span> <span class="entity function">xTemp*sin</span>(theta) <span class="operator">+</span> vect<span class="operator">.</span><span class="entity function">y*cos</span>(theta);
    <span class="keyword">return</span> vect;
}
